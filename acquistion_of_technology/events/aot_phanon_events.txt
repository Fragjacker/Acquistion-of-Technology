namespace = aot_phanon_events
# Start the Mirror in the Sky event here.
country_event = {
    id = aot_phanon_events.1
    title = "aot_phanon_events.1.name"
    desc = "aot_phanon_events.1.desc"
    is_triggered_only = yes
    picture = GFX_evt_dimensional_mirror
    show_sound = event_phanon_discovery
    option = {
        allow = {
            NOT = {
                has_event_chain = phanon_dimensional_mirror_chain
            }
        }
        name = aot_phanon_events.1.a
        custom_tooltip = aot_phanon_events.1.a_desc
        set_country_flag = offer_phanon_dimensional_mirror_chain
        default_hide_option = yes
        trigger = {
            is_ai = no
        }
        hidden_effect = {
            begin_event_chain = {
                event_chain = phanon_dimensional_mirror_chain
            }
            capital_scope = {
                save_event_target_as = pc_home
            }
            enable_special_project = {
                name = "RESEARCH_PHANON_DIMENSIONAL_MIRROR"
                location = event_target:pc_home
                owner = root
            }
        }
        ai_chance = {
            factor = 0
        }
    }
    option = {
        name = aot_phanon_dimensional_mirror_postpone
        custom_tooltip = aot_phanon_dimensional_mirror_postpone_desc
        trigger = {
            is_ai = no
        }
        set_timed_country_flag = {
            flag = block_phanon_dimensional_mirror_chain
            years = 5
        }
        ai_chance = {
            factor = 0
        }
    }
    option = {
        name = aot_dm_production_core_skip
        custom_tooltip = aot_dm_production_core_skip_desc
        trigger = {
            is_ai = no
        }
        set_country_flag = block_phanon_dimensional_mirror_chain
        ai_chance = {
            factor = 0
        }
    }
    # The AI is too dumb for this, so give the option right away but without any progress.
    option = {
        name = aot_phanon_events.1.a
        custom_tooltip = aot_phanon_events.1.a_desc
        set_country_flag = offer_phanon_dimensional_mirror_chain
        trigger = {
            is_ai = yes
        }
        random_list = {
            60 = {
            }
            40 = {
                hidden_effect = {
                    phanon_type_a_tech_gift = yes
                    phanon_type_civ_tech_gift = yes
                    phanon_type_ship_tech_gift = yes
                    phanon_type_b_tech_gift = yes
                    phanon_species_traits_tech_gift_card = yes
                }
            }
        }
        ai_chance = {
            factor = 1000
        }
    }
}

# Phanon - For AI
country_event = {
    id = aot_phanon_events.101
    hide_window = yes
    trigger = {
        is_ai = yes
        NOR = {
            has_global_flag = acot_phanon_forbidden
            has_country_flag = acot_phanon_tech_enabled
            has_country_flag = offer_phanon_dimensional_mirror_chain
            has_technology = tech_dark_matter_power_core_re
            has_tech_option = tech_dark_matter_power_core_re
        }
        has_technology = tech_dark_matter_power_core_ae
        has_established_contact = event_target:acot_precursor_databank_country
        is_playable_country = yes
        is_fallen_empire = no        # SIR NO SIR
        OR = {
            AND = {
                NOT = {
                    has_global_flag = acot_ai_simple_event_forbidden
                }
                resource_stockpile_compare = {
                    resource = acot_sr_dark_energy
                    value >= 1000
                }
                resource_stockpile_compare = {
                    resource = sr_dark_matter
                    value >= 1000
                }
            }
            AND = {
                has_global_flag = acot_ai_simple_event_forbidden
                resource_stockpile_compare = {
                    resource = acot_sr_dark_energy
                    value >= 10000
                }
                resource_stockpile_compare = {
                    resource = sr_dark_matter
                    value >= 10000
                }
            }
            OR = {
                end_game_years_passed >= 0
                mid_game_years_passed >= 10
            }
        }
    }
    mean_time_to_happen = {
        years = 20
    }
    immediate = {
        set_country_flag = hear_stellarite
        if = {
            limit = {
                NOT = {
                    has_global_flag = acot_ai_simple_event_forbidden
                }
            }
            add_resource = {
                sr_dark_matter = -1000
                acot_sr_dark_energy = -1000
            }
        }
        if = {
            limit = {
                has_global_flag = acot_ai_simple_event_forbidden
            }
            add_resource = {
                sr_dark_matter = -10000
                acot_sr_dark_energy = -10000
            }
        }
        add_research_option = tech_dark_matter_power_core_re
        set_country_flag = acot_phanon_tech_enabled
    }
}

# SUCCESSS, MIRROR MIRROR IN ZE SPACE!
country_event = {
    id = aot_phanon_events.2
    title = aot_phanon_events.2.name
    desc = aot_phanon_events.2.desc
    picture = GFX_evt_dimensional_mirror
    show_sound = phanon_megastructure_upgrade_1
    is_triggered_only = yes
    trigger = {
    }
    immediate = {
        end_event_chain = phanon_dimensional_mirror_chain
        set_country_flag = finished_phanon_dimensional_mirror_chain
    }
    ### PHANONTASTIC MIRROR
    option = {
        name = aot_phanon_events.2.a
        add_research_option = tech_phanon_dimensional_mirror
        add_tech_progress = {
            tech = tech_phanon_dimensional_mirror
            progress = 0.1
        }
    }
}

# Finished Dimensional Mirror research, now built it Senpai!
country_event = {
    id = aot_phanon_events.21
    title = aot_phanon_events.21.name
    desc = aot_phanon_events.21.desc
    picture = GFX_evt_dimensional_mirror
    show_sound = phanon_megastructure_upgrade_2
    is_triggered_only = yes
    trigger = {
        last_increased_tech = tech_phanon_dimensional_mirror
    }
    immediate = {
    }
    ### PHANONTASTIC MIRROR
    option = {
        name = EXCELLENT
    }
}

# MIRROR BUILD BUT NEEDS ACTIVATION
country_event = {
    id = aot_phanon_events.3
    title = aot_phanon_events.3.name
    desc = aot_phanon_events.3.desc
    picture = GFX_evt_dimensional_mirror
    show_sound = phanon_megastructure_upgrade_2
    is_triggered_only = yes
    location = from
    trigger = {
        NOR = {
            has_country_flag = completed_dimensional_mirror
            has_country_flag = defeated_wave_1
            has_country_flag = defeated_wave_2
            has_country_flag = defeated_wave_3
            has_country_flag = defeated_wave_4
        }
    }
    immediate = {
        if = {
            limit = {
                NOT = {
                    has_country_flag = completed_dimensional_mirror
                }
            }
            set_country_flag = completed_dimensional_mirror
        }
    }
}

# MIRROR IS FULLY OPERATIONAL
country_event = {
    id = aot_phanon_events.4
    title = aot_phanon_events.4.name
    location = from
    desc = {
        trigger = {
            root = {
                has_country_flag = defeated_wave_1
                NOT = {
                    has_country_flag = defeated_wave_2
                }
            }
        }
        text = aot_phanon_events.4.wave1.desc
    }
    desc = {
        trigger = {
            root = {
                has_country_flag = defeated_wave_1
                has_country_flag = defeated_wave_2
                NOT = {
                    has_country_flag = defeated_wave_3
                }
            }
        }
        text = aot_phanon_events.4.wave2.desc
    }
    desc = {
        trigger = {
            root = {
                has_country_flag = defeated_wave_1
                has_country_flag = defeated_wave_2
                has_country_flag = defeated_wave_3
                NOT = {
                    has_country_flag = defeated_wave_4
                }
            }
        }
        text = aot_phanon_events.4.wave3.desc
    }
    desc = {
        trigger = {
            root = {
                has_country_flag = defeated_wave_1
                has_country_flag = defeated_wave_2
                has_country_flag = defeated_wave_3
                has_country_flag = defeated_wave_4
            }
        }
        text = aot_phanon_events.4.wave4.desc
    }
    picture = GFX_evt_dimensional_mirror
    show_sound = phanon_megastructure_build_completed
    is_triggered_only = yes
    trigger = {
    }
    immediate = {
    }
    option = {
        name = aot_phanon_events.4.a
        hidden_effect = {
            country_event = {
                id = aot_phanon_events.7
                days = 5
                random = 3
            }
        }
    }
}

# GATE GETS POWERED DOWN
country_event = {
    id = aot_phanon_events.5
    is_triggered_only = yes
    hide_window = yes
    trigger = {
    }
    immediate = {
        every_megastructure = {
            limit = {
                is_megastructure_type = dimensional_mirror_final
            }
            solar_system = {
                spawn_megastructure = {
                    type = dimensional_mirror_0
                    owner = root
                    coords_from = prev
                }
            }
            remove_megastructure = this
        }
    }
}

# FAKE MEME MESSAGE SUCCEEDED, SENDING NEW PHANON VAULT.
country_event = {
    id = aot_phanon_events.6
    hide_window = yes
    is_triggered_only = yes
    trigger = {
    }
    immediate = {
        # Spawn the vault plus some Phanon bois to defend.
        event_target:dimensional_mirror_obj = {
            create_phanon_protecc_wave_1 = yes
            create_phanon_protecc_wave_2 = yes
            create_phanon_protecc_wave_3 = yes
            create_phanon_protecc_wave_4 = yes
            move_protecc_fleet_to_system_star = yes
            solar_system = {
                spawn_planet = {
                    name = "V-N1C3V"
                    class = pc_acot_pmc_vault
                    orbit_distance = 25
                    size = 20
                    orbit_angle = 20
                    init_effect = {
                        save_global_event_target_as = aot_bootleg_phanon_vault
                        set_owner = event_target:phanon_protecc_base_country
                        set_controller = event_target:phanon_protecc_base_country
                        set_surveyed = {
                            surveyed = yes
                            surveyor = root
                        }
                        while = {
                            count = 10
                            add_district = district_acot_phanon_main
                        }
                        while = {
                            count = 3
                            add_district = district_acot_phanon_a
                        }
                        while = {
                            count = 3
                            add_district = district_acot_phanon_b
                        }
                        while = {
                            count = 3
                            add_district = district_acot_phanon_c
                        }
                        # First 6 Slots
                        add_building = building_acot_phanon_capital
                        add_building = building_acot_phanon_lab
                        add_building = building_acot_phanon_vault
                        add_building = building_acot_phanon_vault
                        add_building = building_acot_phanon_singularity
                        add_building = building_acot_phanon_singularity
                        # Capital Zone 1
                        add_zone = {
                            district = district_acot_phanon_main
                            zone = zone_acot_vault_main_sub
                            zone_slot = 1
                            replace = yes
                        }
                        add_building = {
                            zone = zone_acot_vault_main_sub
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_main_sub
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_main_sub
                            building = building_acot_phanon_lab
                        }
                        # Capital Zone 2
                        add_zone = {
                            district = district_acot_phanon_main
                            zone = zone_acot_vault_main_sub
                            zone_slot = 2
                            replace = yes
                        }
                        add_building = {
                            zone = zone_acot_vault_main_sub
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_main_sub
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_main_sub
                            building = building_acot_phanon_singularity
                        }
                        # Zone A
                        add_building = {
                            zone = zone_acot_vault_a
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_a
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_a
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_a
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_a
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_a
                            building = building_acot_phanon_singularity
                        }
                        add_zone = {
                            district = district_acot_phanon_a
                            zone = zone_acot_vault_a_01
                            zone_slot = 1
                            replace = yes
                        }
                        add_building = {
                            zone = zone_acot_vault_a_01
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_a_01
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_a_01
                            building = building_acot_phanon_lab
                        }
                        add_zone = {
                            district = district_acot_phanon_a
                            zone = zone_acot_vault_a_01
                            zone_slot = 2
                            replace = yes
                        }
                        add_building = {
                            zone = zone_acot_vault_a_01
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_a_01
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_a_01
                            building = building_acot_phanon_singularity
                        }
                        # Zone B
                        add_building = {
                            zone = zone_acot_vault_b
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_b
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_b
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_b
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_b
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_b
                            building = building_acot_phanon_singularity
                        }
                        add_zone = {
                            district = district_acot_phanon_b
                            zone = zone_acot_vault_b_01
                            zone_slot = 1
                            replace = yes
                        }
                        add_building = {
                            zone = zone_acot_vault_b_01
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_b_01
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_b_01
                            building = building_acot_phanon_lab
                        }
                        add_zone = {
                            district = district_acot_phanon_b
                            zone = zone_acot_vault_b_01
                            zone_slot = 2
                            replace = yes
                        }
                        add_building = {
                            zone = zone_acot_vault_b_01
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_b_01
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_b_01
                            building = building_acot_phanon_singularity
                        }
                        # Zone C
                        add_building = {
                            zone = zone_acot_vault_c
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_c
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_c
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_c
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_c
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_c
                            building = building_acot_phanon_singularity
                        }
                        add_zone = {
                            district = district_acot_phanon_c
                            zone = zone_acot_vault_c_01
                            zone_slot = 1
                            replace = yes
                        }
                        add_building = {
                            zone = zone_acot_vault_c_01
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_c_01
                            building = building_acot_phanon_lab
                        }
                        add_building = {
                            zone = zone_acot_vault_c_01
                            building = building_acot_phanon_lab
                        }
                        add_zone = {
                            district = district_acot_phanon_c
                            zone = zone_acot_vault_c_01
                            zone_slot = 2
                            replace = yes
                        }
                        add_building = {
                            zone = zone_acot_vault_c_01
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_c_01
                            building = building_acot_phanon_singularity
                        }
                        add_building = {
                            zone = zone_acot_vault_c_01
                            building = building_acot_phanon_singularity
                        }
                        change_colony_foundation_date = -15123    # it has to be 42yr and 3 days
                        create_pop_group = {
                            species = event_target:phanon_species
                            size = 30000
                        }
                        while = {
                            count = 30
                            create_army = {
                                owner = event_target:phanon_base_country
                                type = acot_phanon_defense_droid
                            }
                        }
                        while = {
                            count = 10
                            create_army = {
                                owner = event_target:phanon_base_country
                                type = acot_phanon_defense_droid_shielder
                            }
                        }
                        while = {
                            count = 5
                            create_army = {
                                owner = event_target:phanon_base_country
                                type = acot_phanon_defense_droid_commando
                            }
                        }
                        while = {
                            count = 1
                            create_army = {
                                owner = event_target:phanon_base_country
                                type = acot_phanon_defense_droid_commander
                            }
                        }
                        ### CD-ROM DROIDS
                        while = {
                            count = 10
                            create_army = {
                                owner = event_target:phanon_base_country
                                type = acot_phanon_defense_droid_shielder
                            }
                        }
                    }
                }
                AoT_add_phanon_vault_tracker = {
                    COUNTRY = this
                    ID = 1
                    LOCATION = event_target:aot_bootleg_phanon_vault
                }
            }
            # Blow up the Mirror now.
            spawn_aot_habitat_blast_effect = yes
            remove_megastructure = this
        }
    }
}

# SENDING MESSAGE TO EMEZON
country_event = {
    id = aot_phanon_events.7
    title = aot_phanon_events.7.diplo_title
    desc = aot_phanon_events.7.diplo.desc
    location = from
    trigger = {
    }
    is_triggered_only = yes
    diplomatic = yes
    show_sound = event_ai_started
    picture_event_data = {
        room = acot_phanon_bridge_hostile_room
    }
    immediate = {
    }
    after = {
    }
    option = {
        trigger = {
            NOT = {
                has_country_flag = defeated_wave_1
            }
        }
        name = aot_phanon_events.7.a
        response_text = aot_phanon_events.7.a.response
        default_hide_option = yes
        hidden_effect = {
            country_event = {
                id = aot_phanon_events.8
                days = 10
                random = 5
            }
        }
    }
    option = {
        trigger = {
            has_country_flag = defeated_wave_1
            NOT = {
                has_country_flag = defeated_wave_2
            }
        }
        name = aot_phanon_events.7.b
        response_text = aot_phanon_events.7.b.response
        default_hide_option = yes
        hidden_effect = {
            country_event = {
                id = aot_phanon_events.8
                days = 10
                random = 5
            }
        }
    }
    option = {
        trigger = {
            has_country_flag = defeated_wave_1
            has_country_flag = defeated_wave_2
            NOT = {
                has_country_flag = defeated_wave_3
            }
        }
        name = aot_phanon_events.7.b
        response_text = aot_phanon_events.7.c.response
        default_hide_option = yes
        hidden_effect = {
            country_event = {
                id = aot_phanon_events.8
                days = 10
                random = 5
            }
        }
    }
    option = {
        trigger = {
            has_country_flag = defeated_wave_1
            has_country_flag = defeated_wave_2
            has_country_flag = defeated_wave_3
            NOT = {
                has_country_flag = defeated_wave_4
            }
        }
        name = aot_phanon_events.7.b
        response_text = aot_phanon_events.7.d.response
        default_hide_option = yes
        hidden_effect = {
            country_event = {
                id = aot_phanon_events.8
                days = 10
                random = 5
            }
        }
    }
    option = {
        trigger = {
            has_country_flag = defeated_wave_1
            has_country_flag = defeated_wave_2
            has_country_flag = defeated_wave_3
            has_country_flag = defeated_wave_4
        }
        name = aot_phanon_events.7.e
        response_text = aot_phanon_events.7.e.response
        default_hide_option = yes
    }
}

# SPAWN ATTACKING P.R.O.T.E.C.C. FLEETS
country_event = {
    id = aot_phanon_events.8
    title = aot_phanon_events.8.name
    location = from
    picture = GFX_evt_dimensional_mirror
    show_sound = event_phanon_vault_summon
    is_triggered_only = yes
    desc = {
        trigger = {
            root = {
                has_country_flag = defeated_wave_1
                NOT = {
                    has_country_flag = defeated_wave_2
                }
            }
        }
        text = aot_phanon_events.8.wave1.desc
    }
    desc = {
        trigger = {
            root = {
                has_country_flag = defeated_wave_1
                has_country_flag = defeated_wave_2
                NOT = {
                    has_country_flag = defeated_wave_3
                }
            }
        }
        text = aot_phanon_events.8.wave2.desc
    }
    desc = {
        trigger = {
            root = {
                has_country_flag = defeated_wave_1
                has_country_flag = defeated_wave_2
                has_country_flag = defeated_wave_3
                NOT = {
                    has_country_flag = defeated_wave_4
                }
            }
        }
        text = aot_phanon_events.8.wave3.desc
    }
    desc = {
        trigger = {
            root = {
                has_country_flag = defeated_wave_1
                has_country_flag = defeated_wave_2
                has_country_flag = defeated_wave_3
                has_country_flag = defeated_wave_4
            }
        }
        text = aot_phanon_events.8.wave4.desc
    }
    option = {
        trigger = {
            NOT = {
                has_country_flag = defeated_wave_4
            }
        }
        name = aot_enigmatic_lock_events.2.a
        name = aot_enigmatic_lock_events.2.b
        name = aot_enigmatic_lock_events.2.c
    }
    option = {
        trigger = {
            has_country_flag = defeated_wave_4
        }
        name = aot_mod_options.koolaid_consoomed.1.b
        name = acot_special_menu.exit.a
        name = aot_phanon_events.1000.a
    }
    trigger = {
    }
    immediate = {
        create_protecc_country = yes
        # SPAWN ENEMIES AT THE GATES
        switch = {
            trigger = has_country_flag
            defeated_wave_3 = {
                set_country_flag = defeated_wave_4
                country_event = {
                    id = aot_phanon_events.6
                }
            }
            defeated_wave_2 = {
                event_target:dimensional_mirror_obj = {
                    create_phanon_protecc_wave_1 = yes
                    create_phanon_protecc_wave_2 = yes
                    create_phanon_protecc_wave_3 = yes
                    move_protecc_fleet_to_system_star = yes
                }
                set_country_flag = defeated_wave_3
                country_event = {
                    id = aot_phanon_events.5
                }
            }
            defeated_wave_1 = {
                event_target:dimensional_mirror_obj = {
                    create_phanon_protecc_wave_1 = yes
                    create_phanon_protecc_wave_2 = yes
                    move_protecc_fleet_to_system_star = yes
                }
                set_country_flag = defeated_wave_2
                country_event = {
                    id = aot_phanon_events.5
                }
            }
            default = {
                event_target:dimensional_mirror_obj = {
                    create_phanon_protecc_wave_1 = yes
                    move_protecc_fleet_to_system_star = yes
                }
                set_country_flag = defeated_wave_1
                country_event = {
                    id = aot_phanon_events.5
                }
            }
        }
    }
}

# Spawn destroyed megaturrets
country_event = {
    id = aot_phanon_events.9
    is_triggered_only = yes
    hide_window = yes
    trigger = {
        fromfrom = {
            is_ship_size = aot_megaturret
        }
    }
    immediate = {
        fromfrom = {
            save_event_target_as = destroyed_megaturret
            spawn_aot_habitat_blast_effect = yes
            solar_system = {
                spawn_megastructure = {
                    type = phanon_megaturret_destroyed_0
                    owner = from
                    coords_from = event_target:destroyed_megaturret
                    orbit_angle = 180
                }
            }
        }
    }
}

##########################
# Megastructure Events
##########################
# Initial Star Imploder Built
country_event = {
    id = aot_phanon_events.1000
    title = "aot_phanon_events.1000.name"
    desc = "aot_phanon_events.1000.desc"
    picture = GFX_evt_unknown_ships
    show_sound = phanon_megastructure_start_build
    location = fromfrom
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = star_imploder_0
        }
    }
    option = {
        name = "aot_phanon_events.1000.a"
    }
}

# Building Star Imploder Notification (HIDDEN)
country_event = {
    id = aot_phanon_events.1001
    hide_window = yes
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = star_imploder_1
        }
    }
    immediate = {
        fromfrom = {
            save_event_target_as = star_imploder_system
        }
        every_playable_country = {
            limit = {
                is_ai = no
                NOT = {
                    is_same_value = root
                }
                OR = {
                    has_intel_level = {
                        who = root
                        category = economy
                        level >= 1
                    }
                    has_intel_level = {
                        who = root
                        category = technology
                        level >= 1
                    }
                }
            }
            country_event = {
                id = aot_phanon_events.1002
            }
        }
    }
    after = {
        if = {
            limit = {
                NOT = {
                    has_country_flag = started_first_stellar_imploder
                }
            }
            set_country_flag = started_first_stellar_imploder
        }
        else_if = {
            limit = {
                has_country_flag = started_first_stellar_imploder
            }
            set_country_flag = started_first_stellar_imploder_2
        }
    }
}

# Building Star Imploder Notification
country_event = {
    id = aot_phanon_events.1002
    title = "aot_phanon_events.1002.name"
    desc = {
        text = aot_phanon_events.1002.desc.a
        trigger = {
            from = {
                has_country_flag = started_first_stellar_imploder
                NOT = {
                    has_country_flag = started_first_stellar_imploder_2
                }
            }
        }
    }
    desc = {
        text = aot_phanon_events.1002.desc.b
        trigger = {
            from = {
                has_country_flag = started_first_stellar_imploder_2
            }
        }
    }
    picture = GFX_evt_stellar_imploder_construction
    show_sound = event_mega_structure_other_empire_build_start
    location = event_target:star_imploder_system
    is_triggered_only = yes
    option = {
        # Has built own Star Imploder
        trigger = {
            OR = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = star_imploder_0
                        is_megastructure_type = star_imploder_1
                        is_megastructure_type = star_imploder_2
                        is_megastructure_type = star_imploder_3
                    }
                }
                has_country_flag = finished_stellar_imploder
            }
        }
        name = "aot_phanon_events.1002.a"
    }
    option = {
        # Has no Star Imploder
        trigger = {
            NOT = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = star_imploder_0
                        is_megastructure_type = star_imploder_1
                        is_megastructure_type = star_imploder_2
                        is_megastructure_type = star_imploder_3
                    }
                }
            }
            NOT = {
                has_country_flag = finished_stellar_imploder
            }
        }
        name = "aot_phanon_events.1002.b"
    }
}

# Star Imploder Built
country_event = {
    id = aot_phanon_events.1003
    title = "aot_phanon_events.1003.name"
    picture = GFX_evt_stellar_imploder_construction
    show_sound = phanon_megastructure_upgrade_1
    location = fromfrom
    is_triggered_only = yes
    desc = {
        trigger = {
            from = {
                is_megastructure_type = star_imploder_1
            }
        }
        text = aot_phanon_events.1003.a.desc
    }
    desc = {
        trigger = {
            from = {
                is_megastructure_type = star_imploder_2
            }
        }
        text = aot_phanon_events.1003.b.desc
    }
    trigger = {
        from = {
            OR = {
                is_megastructure_type = star_imploder_1
                is_megastructure_type = star_imploder_2
            }
        }
    }
    option = {
        name = "aot_phanon_events.1003.a"
    }
}

# Star Imploder Completed
country_event = {
    id = aot_phanon_events.1004
    title = "aot_phanon_events.1004.name"
    desc = {
        text = aot_phanon_events.1004.desc.a
        trigger = {
            NOT = {
                has_country_flag = finished_stellar_imploder
            }
        }
    }
    desc = {
        text = aot_phanon_events.1004.desc.b
        trigger = {
            has_country_flag = finished_stellar_imploder
        }
    }
    picture = GFX_evt_phanon_pylon_supernova
    show_sound = phanon_megastructure_build_completed
    location = fromfrom
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = star_imploder_3
        }
        fromfrom = {
            NOT = {
                any_system_megastructure = {
                    is_megastructure_type = star_imploder_2
                }
            }
        }
    }
    immediate = {
        fromfrom = {
            save_event_target_as = completed_star_imploder_system
        }
        every_playable_country = {
            limit = {
                is_ai = no
                NOT = {
                    is_same_value = root
                }
                OR = {
                    has_intel_level = {
                        who = root
                        category = economy
                        level >= 1
                    }
                    has_intel_level = {
                        who = root
                        category = technology
                        level >= 1
                    }
                }
            }
            hidden_effect = {
                country_event = {
                    id = aot_phanon_events.1005
                }
            }
        }
    }
    after = {
        hidden_effect = {
            country_event = {
                id = aot_phanon_events.1006
                days = 5
            }
        }
    }
    option = {
        name = "aot_phanon_events.1004.a"
    }
}

# Star Imploder Completed (Others)
country_event = {
    id = aot_phanon_events.1005
    title = "aot_phanon_events.1005.name"
    desc = {
        text = aot_phanon_events.1005.desc.a
        trigger = {
            NOT = {
                from = {
                    has_country_flag = finished_stellar_imploder
                }
            }
        }
    }
    desc = {
        text = aot_phanon_events.1005.desc.b
        trigger = {
            from = {
                has_country_flag = finished_stellar_imploder
            }
        }
    }
    picture = GFX_evt_phanon_pylon_supernova
    show_sound = event_mega_structure_other_empire_build_complete
    location = event_target:completed_star_imploder_system
    is_triggered_only = yes
    option = {
        # Has built own Star Imploder
        trigger = {
            OR = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = star_imploder_0
                        is_megastructure_type = star_imploder_1
                        is_megastructure_type = star_imploder_2
                        is_megastructure_type = star_imploder_3
                    }
                }
                has_country_flag = finished_stellar_imploder
            }
        }
        name = "aot_phanon_events.1005.a"
    }
    option = {
        # Has no Star Imploder
        trigger = {
            any_owned_megastructure = {
                NOR = {
                    is_megastructure_type = star_imploder_0
                    is_megastructure_type = star_imploder_1
                    is_megastructure_type = star_imploder_2
                    is_megastructure_type = star_imploder_3
                }
            }
            NOT = {
                has_country_flag = finished_stellar_imploder
            }
        }
        name = "aot_phanon_events.1005.b"
    }
}

# Star Imploder Flag Event (HIDDEN)
country_event = {
    id = aot_phanon_events.1006
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        set_country_flag = finished_stellar_imploder
    }
}

#############################################
# Solaripp RIPP
#############################################
# Initial Mac RIPP Built
country_event = {
    id = aot_phanon_events.2000
    title = "aot_phanon_events.2000.name"
    desc = "aot_phanon_events.2000.desc"
    picture = GFX_evt_unknown_ships
    show_sound = phanon_megastructure_start_build
    location = fromfrom
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = solaripp_0
        }
    }
    option = {
        name = "aot_phanon_events.2000.a"
    }
}

# Building Mac RIPP Notification (HIDDEN)
country_event = {
    id = aot_phanon_events.2001
    hide_window = yes
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = solaripp_0
        }
    }
    immediate = {
        fromfrom = {
            save_event_target_as = macripp_system
        }
        every_playable_country = {
            limit = {
                is_ai = no
                NOT = {
                    is_same_value = root
                }
                OR = {
                    has_intel_level = {
                        who = root
                        category = economy
                        level >= 1
                    }
                    has_intel_level = {
                        who = root
                        category = technology
                        level >= 1
                    }
                }
            }
            country_event = {
                id = aot_phanon_events.2002
            }
        }
    }
    after = {
        if = {
            limit = {
                NOT = {
                    has_country_flag = started_first_macripp
                }
            }
            set_country_flag = started_first_macripp
        }
        else_if = {
            limit = {
                has_country_flag = started_first_macripp
            }
            set_country_flag = started_first_solaripp_2
        }
    }
}

# Building Mac RIPP Notification
country_event = {
    id = aot_phanon_events.2002
    title = "aot_phanon_events.2002.name"
    desc = {
        text = aot_phanon_events.2002.desc.a
        trigger = {
            from = {
                has_country_flag = started_first_macripp
                NOT = {
                    has_country_flag = started_first_solaripp_2
                }
            }
        }
    }
    desc = {
        text = aot_phanon_events.2002.desc.b
        trigger = {
            from = {
                has_country_flag = started_first_solaripp_2
            }
        }
    }
    picture = GFX_evt_phanon_macripp_construction
    show_sound = event_mega_structure_other_empire_build_start
    location = event_target:macripp_system
    is_triggered_only = yes
    option = {
        # Has built own Mac RIPP
        trigger = {
            OR = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = solaripp_0
                        is_megastructure_type = solaripp_1
                        is_megastructure_type = solaripp_2
                        is_megastructure_type = solaripp_3
                    }
                }
                has_country_flag = finished_macripp
            }
        }
        name = "aot_phanon_events.2002.a"
    }
    option = {
        # Has no Mac RIPP
        trigger = {
            NOT = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = solaripp_0
                        is_megastructure_type = solaripp_1
                        is_megastructure_type = solaripp_2
                        is_megastructure_type = solaripp_3
                    }
                }
            }
            NOT = {
                has_country_flag = finished_macripp
            }
        }
        name = "aot_phanon_events.2002.b"
    }
}

# Mac RIPP Built
country_event = {
    id = aot_phanon_events.2003
    title = "aot_phanon_events.2003.name"
    picture = GFX_evt_phanon_macripp_construction
    show_sound = phanon_megastructure_upgrade_1
    location = fromfrom
    is_triggered_only = yes
    desc = {
        trigger = {
            from = {
                is_megastructure_type = solaripp_1
            }
        }
        text = aot_phanon_events.2003.a.desc
    }
    desc = {
        trigger = {
            from = {
                is_megastructure_type = solaripp_2
            }
        }
        text = aot_phanon_events.2003.b.desc
    }
    trigger = {
        from = {
            OR = {
                is_megastructure_type = solaripp_1
                is_megastructure_type = solaripp_2
            }
        }
    }
    option = {
        name = "aot_phanon_events.2003.a"
    }
}

# Mac RIPP Completed
country_event = {
    id = aot_phanon_events.2004
    title = "aot_phanon_events.2004.name"
    desc = {
        text = aot_phanon_events.2004.desc.a
        trigger = {
            NOT = {
                has_country_flag = finished_macripp
            }
        }
    }
    desc = {
        text = aot_phanon_events.2004.desc.b
        trigger = {
            has_country_flag = finished_macripp
        }
    }
    picture = GFX_evt_phanon_macripp_construction
    show_sound = phanon_megastructure_build_completed
    location = fromfrom
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = solaripp_3
        }
        fromfrom = {
            NOT = {
                any_system_megastructure = {
                    is_megastructure_type = solaripp_3
                }
            }
        }
    }
    immediate = {
        fromfrom = {
            save_event_target_as = completed_solaripp_system
        }
        every_playable_country = {
            limit = {
                is_ai = no
                NOT = {
                    is_same_value = root
                }
                OR = {
                    has_intel_level = {
                        who = root
                        category = economy
                        level >= 1
                    }
                    has_intel_level = {
                        who = root
                        category = technology
                        level >= 1
                    }
                }
            }
            hidden_effect = {
                country_event = {
                    id = aot_phanon_events.2005
                }
            }
        }
    }
    after = {
        hidden_effect = {
            country_event = {
                id = aot_phanon_events.2006
                days = 5
            }
        }
    }
    option = {
        name = "aot_phanon_events.2004.a"
    }
}

# Mac RIPP Completed (Others)
country_event = {
    id = aot_phanon_events.2005
    title = "aot_phanon_events.2005.name"
    desc = {
        text = aot_phanon_events.2005.desc.a
        trigger = {
            NOT = {
                from = {
                    has_country_flag = finished_macripp
                }
            }
        }
    }
    desc = {
        text = aot_phanon_events.2005.desc.b
        trigger = {
            from = {
                has_country_flag = finished_macripp
            }
        }
    }
    picture = GFX_evt_phanon_macripp_construction
    show_sound = event_mega_structure_other_empire_build_complete
    location = event_target:completed_solaripp_system
    is_triggered_only = yes
    option = {
        # Has built own Mac RIPP
        trigger = {
            OR = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = solaripp_0
                        is_megastructure_type = solaripp_1
                        is_megastructure_type = solaripp_2
                        is_megastructure_type = solaripp_3
                    }
                }
                has_country_flag = finished_macripp
            }
        }
        name = "aot_phanon_events.2005.a"
    }
    option = {
        # Has no Mac RIPP
        trigger = {
            any_owned_megastructure = {
                NOR = {
                    is_megastructure_type = solaripp_0
                    is_megastructure_type = solaripp_1
                    is_megastructure_type = solaripp_2
                    is_megastructure_type = solaripp_3
                }
            }
            NOT = {
                has_country_flag = finished_macripp
            }
        }
        name = "aot_phanon_events.2005.b"
    }
}

# Star Imploder Flag Event (HIDDEN)
country_event = {
    id = aot_phanon_events.2006
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        set_country_flag = finished_macripp
    }
}

#############################################
# Great Wall
#############################################
# Initial Great Wall Built
country_event = {
    id = aot_phanon_events.3000
    title = "aot_phanon_events.3000.name"
    desc = "aot_phanon_events.3000.desc"
    picture = GFX_evt_unknown_ships
    show_sound = phanon_megastructure_start_build
    location = fromfrom
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = phanon_great_wall_0
        }
    }
    option = {
        name = "aot_phanon_events.3000.a"
    }
}

# Building Great Wall Notification (HIDDEN)
country_event = {
    id = aot_phanon_events.3001
    hide_window = yes
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = phanon_great_wall_0
        }
    }
    immediate = {
        fromfrom = {
            save_event_target_as = great_wall_system
        }
        every_playable_country = {
            limit = {
                is_ai = no
                NOT = {
                    is_same_value = root
                }
                OR = {
                    has_intel_level = {
                        who = root
                        category = economy
                        level >= 1
                    }
                    has_intel_level = {
                        who = root
                        category = technology
                        level >= 1
                    }
                }
            }
            country_event = {
                id = aot_phanon_events.3002
            }
        }
    }
    after = {
        if = {
            limit = {
                NOT = {
                    has_country_flag = started_first_great_wall
                }
            }
            set_country_flag = started_first_great_wall
        }
        else_if = {
            limit = {
                has_country_flag = started_first_great_wall
            }
            set_country_flag = started_first_great_wall_2
        }
    }
}

# Building Great Wall Notification
country_event = {
    id = aot_phanon_events.3002
    title = "aot_phanon_events.3002.name"
    desc = {
        text = aot_phanon_events.3002.desc.a
        trigger = {
            from = {
                has_country_flag = started_first_great_wall
                NOT = {
                    has_country_flag = started_first_great_wall_2
                }
            }
        }
    }
    desc = {
        text = aot_phanon_events.3002.desc.b
        trigger = {
            from = {
                has_country_flag = started_first_great_wall_2
            }
        }
    }
    picture = GFX_evt_great_wall_construction
    show_sound = event_mega_structure_other_empire_build_start
    location = event_target:great_wall_system
    is_triggered_only = yes
    option = {
        # Has built own Great Wall
        trigger = {
            OR = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = phanon_great_wall_0
                        is_megastructure_type = phanon_great_wall_1
                        is_megastructure_type = phanon_great_wall_2
                        is_megastructure_type = phanon_great_wall_3
                        is_megastructure_type = phanon_great_wall_4
                    }
                }
                has_country_flag = finished_great_wall
            }
        }
        name = "aot_phanon_events.3002.a"
    }
    option = {
        # Has no Great Wall
        trigger = {
            NOT = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = phanon_great_wall_0
                        is_megastructure_type = phanon_great_wall_1
                        is_megastructure_type = phanon_great_wall_2
                        is_megastructure_type = phanon_great_wall_3
                        is_megastructure_type = phanon_great_wall_4
                    }
                }
            }
            NOT = {
                has_country_flag = finished_great_wall
            }
        }
        name = "aot_phanon_events.3002.b"
    }
}

# Great Wall Built
country_event = {
    id = aot_phanon_events.3003
    title = "aot_phanon_events.3003.name"
    picture = GFX_evt_great_wall_construction
    show_sound = phanon_megastructure_upgrade_2
    location = fromfrom
    is_triggered_only = yes
    desc = {
        trigger = {
            from = {
                is_megastructure_type = phanon_great_wall_1
            }
        }
        text = aot_phanon_events.3003.a.desc
    }
    desc = {
        trigger = {
            from = {
                is_megastructure_type = phanon_great_wall_2
            }
        }
        text = aot_phanon_events.3003.b.desc
    }
    desc = {
        trigger = {
            from = {
                is_megastructure_type = phanon_great_wall_3
            }
        }
        text = aot_phanon_events.3003.c.desc
    }
    trigger = {
        from = {
            OR = {
                is_megastructure_type = phanon_great_wall_1
                is_megastructure_type = phanon_great_wall_2
                is_megastructure_type = phanon_great_wall_3
            }
        }
    }
    option = {
        name = "aot_phanon_events.3003.a"
    }
}

# Great Wall Completed
country_event = {
    id = aot_phanon_events.3004
    title = "aot_phanon_events.3004.name"
    desc = {
        text = aot_phanon_events.3004.desc.a
        trigger = {
            NOT = {
                has_country_flag = finished_great_wall
            }
        }
    }
    desc = {
        text = aot_phanon_events.3004.desc.b
        trigger = {
            has_country_flag = finished_great_wall
        }
    }
    picture = GFX_evt_great_wall_construction
    show_sound = phanon_megastructure_build_completed
    location = fromfrom
    is_triggered_only = yes
    trigger = {
        from = {
            is_megastructure_type = phanon_great_wall_4
        }
    }
    immediate = {
        fromfrom = {
            save_event_target_as = completed_great_wall_system
        }
        every_playable_country = {
            limit = {
                is_ai = no
                NOT = {
                    is_same_value = root
                }
                OR = {
                    has_intel_level = {
                        who = root
                        category = economy
                        level >= 1
                    }
                    has_intel_level = {
                        who = root
                        category = technology
                        level >= 1
                    }
                }
            }
            hidden_effect = {
                country_event = {
                    id = aot_phanon_events.3005
                }
            }
        }
    }
    after = {
        hidden_effect = {
            country_event = {
                id = aot_phanon_events.3006
                days = 5
            }
        }
    }
    option = {
        name = "aot_phanon_events.3004.a"
    }
}

# Great Wall Completed (Others)
country_event = {
    id = aot_phanon_events.3005
    title = "aot_phanon_events.3005.name"
    desc = {
        text = aot_phanon_events.3005.desc.a
        trigger = {
            NOT = {
                from = {
                    has_country_flag = finished_great_wall
                }
            }
        }
    }
    desc = {
        text = aot_phanon_events.3005.desc.b
        trigger = {
            from = {
                has_country_flag = finished_great_wall
            }
        }
    }
    picture = GFX_evt_great_wall_construction
    show_sound = event_mega_structure_other_empire_build_complete
    location = event_target:completed_great_wall_system
    is_triggered_only = yes
    option = {
        # Has built own Great Wall
        trigger = {
            OR = {
                any_owned_megastructure = {
                    OR = {
                        is_megastructure_type = phanon_great_wall_0
                        is_megastructure_type = phanon_great_wall_1
                        is_megastructure_type = phanon_great_wall_2
                        is_megastructure_type = phanon_great_wall_3
                        is_megastructure_type = phanon_great_wall_4
                    }
                }
                has_country_flag = finished_great_wall
            }
        }
        name = "aot_phanon_events.3005.a"
    }
    option = {
        # Has no Great Wall
        trigger = {
            any_owned_megastructure = {
                NOR = {
                    is_megastructure_type = phanon_great_wall_0
                    is_megastructure_type = phanon_great_wall_1
                    is_megastructure_type = phanon_great_wall_2
                    is_megastructure_type = phanon_great_wall_3
                    is_megastructure_type = phanon_great_wall_4
                }
            }
            NOT = {
                has_country_flag = finished_great_wall
            }
        }
        name = "aot_phanon_events.3005.b"
    }
}

# Great Wall Flag Flag Event (HIDDEN)
country_event = {
    id = aot_phanon_events.3006
    hide_window = yes
    is_triggered_only = yes
    immediate = {
        set_country_flag = finished_great_wall
    }
}

# Great Wall tech acquired, add a megaturret design now to be safe.
country_event = {
    id = aot_phanon_events.4000
    hide_window = yes
    is_triggered_only = yes
    trigger = {
        OR = {
            last_increased_tech = tech_phanon_great_wall
        }
    }
    immediate = {
        create_ship_design = {
            design = NAME_AOT_MEGATURRET
        }
        add_ship_design = last_created_design
    }
}
