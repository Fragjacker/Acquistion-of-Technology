namespace = aot_startup
# Set global flag to detect if this mod is installed
event = {
    id = aot_startup.1
    hide_window = yes
    fire_only_once = yes
    is_triggered_only = yes
    trigger = {
        NOT = {
            has_global_flag = has_aot_mod
            has_global_flag = aot_live_version_v6
        }
    }
    immediate = {
        set_global_flag = has_aot_mod
        set_global_flag = aot_live_version_v6
    }
}

event = {
    id = aot_startup.9998
    hide_window = yes
    is_triggered_only = yes

    trigger = {
        NAND = {
            has_global_flag = acot_live_version_v5
            has_global_flag = aot_live_version_v6
        }
    }

    immediate = {
        if = {
            limit = { NOT = { has_global_flag = aot_live_version_v6 } }
            set_global_flag = aot_live_version_v6 # Set it now so the event won't trigger more than once.
            set_global_flag = has_wrong_AoT_version # Set this flag here for error handling downstream.
        }
        every_playable_country = {
            limit = {
                is_ai = no
            }
            country_event = {
                id = aot_startup.9999
            }
        }
    }
    after = {
    }
}

country_event = {
    id = aot_startup.9999
    title = aot_startup.9999.name
    desc = aot_startup.9999.desc
    is_triggered_only = yes
    diplomatic = yes
    show_sound = event_warning_suffering

    picture_event_data = {
        room = aot_outdated_mod_warning_room
    }
    custom_gui = "acot_enclave_phanon_window"
    custom_gui_option = "acot_enclave_phanon_option"

    immediate = {
    }

    option = {
        trigger = {
            NAND = {
                has_global_flag = has_wrong_AoT_version
                has_global_flag = acot_live_version_v5
            }
        }
        name = aot_startup.9999.a
        response_text = aot_startup.9999.a1.response
        is_dialog_only = yes
    }
    option = {
        trigger = {
            has_global_flag = has_wrong_AoT_version
            has_global_flag = acot_live_version_v5
        }
        name = aot_startup.9999.a
        response_text = aot_startup.9999.a2.response
        is_dialog_only = yes
    }
    option = {
        name = aot_startup.9999.e
        response_text = aot_startup.9999.e.response
        every_playable_country = {
            every_owned_fleet = {
                set_owner = root
            }
            every_owned_army = {
                set_owner = root
            }
            every_owned_megastructure = {
                set_owner = root
            }
            every_owned_planet = {
                set_owner = root
            }
        }
        win = yes
    }
    option = {
        name = aot_startup.9999.f
        response_text = aot_startup.9999.f.response
        hidden_effect = {
            set_global_flag = aot_live_version_v6
        }
    }

    after = {
    }
}