###############################################################
# Government Building
###############################################################
building_acot_dm_ancient_palace = {
	inline_script = {
		script = buildings/capital_buildings_boilerplate
		TIER = @DELTA_TIER
		EXPONENT = @ALPHA_EXPONENT
		OVERLORD_JOB = acot_overlord
		OVERSEER_JOB = acot_overseer
		ENFORCER_JOB = aot_dm_enforcer
		PRODUCES = "
			energy = 20
			sr_dark_matter = 10
			acot_sr_dark_energy = 10
			"
		COST = "
			minerals = 1000
			sr_dark_matter = 100
			"
	}
	country_modifier = {
		country_resource_max_add = 10000
		country_resource_max_acot_sr_dark_energy_add = 2500
		country_resource_max_sr_dark_matter_add = 2500
	}
	upgrades = {
		building_acot_ae_ancient_palace
	}
	potential = {
		exists = planet_owner
		planet_owner = {
			is_individualistic_empire = yes
			has_technology = tech_acot_dm_ancient_palace
		}
	}
	convert_to = {
		building_ancient_control_center
		building_ancient_palace
		building_ancient_hive_capital
		building_acot_dm_ancient_control_center
		building_acot_dm_ancient_hive_cluster
	}
	prerequisites = {
		tech_acot_dm_ancient_palace
	}
	show_tech_unlock_if = {
		is_regular_empire = yes
	}
}

# Supra Nexus
building_acot_dm_ancient_control_center = {
	inline_script = {
		script = buildings/capital_buildings_boilerplate
		TIER = @DELTA_TIER
		EXPONENT = @ALPHA_EXPONENT
		OVERLORD_JOB = acot_overlord_droid
		OVERSEER_JOB = acot_overseer_droid
		ENFORCER_JOB = aot_dm_enforcer_drone
		PRODUCES = "energy = 20
			sr_dark_matter = 10
			acot_sr_dark_energy = 10"
		COST = "minerals = 1000
			sr_dark_matter = 100"
	}
	country_modifier = {
		country_resource_max_add = 10000
		country_resource_max_acot_sr_dark_energy_add = 2500
		country_resource_max_sr_dark_matter_add = 2500
	}
	upgrades = {
		building_acot_ae_ancient_control_center
	}
	potential = {
		exists = planet_owner
		planet_owner = {
			is_machine_empire = yes
		}
	}
	convert_to = {
		building_ancient_control_center
		building_ancient_palace
		building_ancient_hive_capital
		building_acot_dm_ancient_palace
		building_acot_dm_ancient_hive_cluster
	}
	prerequisites = {
		tech_acot_dm_ancient_control_center
	}
	show_tech_unlock_if = {
		is_machine_empire = yes
	}
}

# Hive Nexus
building_acot_dm_ancient_hive_cluster = {
	inline_script = {
		script = buildings/capital_buildings_boilerplate
		TIER = @DELTA_TIER
		EXPONENT = @ALPHA_EXPONENT
		OVERLORD_JOB = acot_overlord_drone
		OVERSEER_JOB = acot_overseer_drone
		ENFORCER_JOB = aot_dm_enforcer_drone
		PRODUCES = "energy = 20
			sr_dark_matter = 10
			acot_sr_dark_energy = 10"
		COST = "minerals = 1000
			sr_dark_matter = 100"
	}
	country_modifier = {
		country_resource_max_add = 10000
		country_resource_max_acot_sr_dark_energy_add = 2500
		country_resource_max_sr_dark_matter_add = 2500
	}
	upgrades = {
		building_acot_ae_ancient_hive_cluster
	}
	potential = {
		exists = planet_owner
		planet_owner = {
			is_hive_empire = yes
		}
	}
	convert_to = {
		building_acot_dm_ancient_control_center
		building_acot_dm_ancient_palace
	}
	prerequisites = {
		tech_acot_dm_ancient_hive_cluster
	}
	show_tech_unlock_if = {
		is_hive_empire = yes
	}
}

#####################
# Production
#####################
building_class_4_singularity = {
	inline_script = {
		script = buildings/production/class_x_singularity
		TIER = @DELTA_TIER
		CAN_BUILD = yes
		PREREQUISITE = tech_fe_class_4_singularity
		ALLOW = "has_enigmatic_capital = yes"
		UPGRADES_INTO = building_ae_class_4_singularity
		JOB = technician
		COST = "
			minerals = 1000
			sr_dark_matter = 150
			"
		PRODUCES = "
			energy = @auto_energy_dm
			"
		UPKEEP = "
			sr_dark_matter = 6
			"
	}
}
building_aot_fe_empyrean_shrine = {
	icon = building_empyrean_shrine
	inline_script = {
		script = buildings/production/empyrean_shrine
		TIER = @DELTA_TIER
		CAN_BUILD = yes
		PREREQUISITE = tech_aot_fe_empyrean_shrine
		UPGRADES_INTO = building_ae_empyrean_shrine
		ALLOW = "
			has_enigmatic_capital = yes
			planet_owner = {
				is_machine_empire = no
			}
			NOT = {
				has_modifier = slave_colony
			}
			"
		JOB = high_priest
		COST = "
			minerals = 750
			sr_dark_matter = 50
			sr_zro = 50
			"
		PRODUCES = "
			unity = @auto_unity_dm
			"
		UPKEEP = "
			sr_dark_matter = 2
			acot_sr_dark_energy = 1
			"
	}
}
building_fe_nano_forge = {
	icon = building_nano_forge
	inline_script = {
		script = buildings/production/nano_forge
		TIER = @DELTA_TIER
		PREREQUISITE = tech_fe_nano_forge
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		UPGRADES_INTO = building_ae_nano_forge
		JOB = foundry
		JOB_DRONE = alloy
		JOB_MACHINE = fabricator
		COST = "
			minerals = 1000
			sr_living_metal = 50
			"
		PRODUCES = "
			alloys = @auto_alloy_dm
			"
		UPKEEP = "
			sr_dark_matter = 4
			acot_sr_dark_energy = 2
			"
	}
}

# Mineral Buildings
building_fe_dimensional_fabricator = {
	icon = building_dimensional_fabricator
	inline_script = {
		script = buildings/production/dimensional_fabricator
		TIER = @DELTA_TIER
		PREREQUISITE = tech_fe_dimensional_fabricator
		UPGRADES_INTO = building_ae_dimensional_fabricator
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		COST = "
			minerals = 1000
			alloys = 250
			rare_crystals = 100
			volatile_motes = 100
			exotic_gases = 100
			"
		PRODUCES = "
			rare_crystals = @auto_sr_dm
			exotic_gases = @auto_sr_dm
			volatile_motes = @auto_sr_dm
			sr_zro = @auto_sr_dm
			sr_living_metal = @auto_sr_dm
			nanites = @auto_nanites_dm
			"
		UPKEEP = "
			energy = 20
			acot_sr_dark_energy = 3
			"
	}
}

# Food Buildings
building_fe_nourishment_center = {
	icon = building_nourishment_center
	inline_script = {
		script = buildings/production/nourishment_center
		TIER = @DELTA_TIER
		PREREQUISITE = tech_fe_nourishment_center
		JOB = farmer
		JOB_DRONE = agri
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		UPGRADES_INTO = building_ae_nourishment_center
		COST = "
			minerals = 1000
			volatile_motes = 150
			"
		PRODUCES = "
			food = @auto_food_dm
			"
		UPKEEP = "
			sr_dark_matter = 2
			acot_sr_dark_energy = 2
			"
	}
}

# Consumer Goods
building_fe_affluence_center = {
	icon = building_affluence_center
	inline_script = {
		script = buildings/production/affluence_center
		TIER = @DELTA_TIER
		PREREQUISITE = tech_fe_affluence_center
		JOB = artisan
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		UPGRADES_INTO = building_ae_affluence_center
		COST = "
			minerals = 1000
			rare_crystals = 150
			"
		PRODUCES = "
			consumer_goods = @auto_cg_dm
			"
		UPKEEP = "
			minerals = 25
			energy = 10
			"
	}
}

# Housing
building_fe_sky_dome = {
	icon = building_fe_dome
	inline_script = {
		script = buildings/production/sky_dome
		TIER = @DELTA_TIER
		PREREQUISITE = tech_fe_sky_dome
		CAN_BUILD = yes
		UPGRADES_INTO = building_ae_sky_dome
		ALLOW = "
			has_enigmatic_capital = yes
			"
		COST = "
			minerals = 750
			rare_crystals = 100
			"
		UPKEEP = "
			energy = 10
			"
		AI_FACTORS = "
			# ---------------------------- Build only if we have no districts left --------------------------- #
			modifier = {
				factor = 0
				free_district_slots > 0
			}
			modifier = {
				factor = 2
				free_district_slots = 0
			}
			modifier = {
				factor = 10
				free_housing <= 0
			}
			"
	}
}
building_fe_master_archive = {
	icon = building_master_archive
	base_cap_amount = 1
	inline_script = {
		script = buildings/production/master_archive
		TIER = @DELTA_TIER
		PREREQUISITE = tech_fe_master_archive
		ALLOW = "
			has_enigmatic_capital = yes
			NOR = {
				has_building = building_ae_master_archive
				has_building = building_stellarite_master_archive
				has_building = building_phanon_master_archive
			}
			"
		CAN_BUILD = yes
		UPGRADES_INTO = building_ae_master_archive
		JOB = head_researcher
		JOB_DRONE = brain_drone
		JOB_MACHINE = calculator
		COST = "
			minerals = 1000
			exotic_gases = 200
			"
		PRODUCES = "
			physics_research = @auto_research_dm
			society_research = @auto_research_dm
			engineering_research = @auto_research_dm
			"
		UPKEEP = "
			energy = 20
			alloys = 3
			sr_dark_matter = 2
			acot_sr_dark_energy = 2
			"
	}
}

# Biological path
building_acot_dm_clone_vats = {
	base_cap_amount = 1
	inline_script = {
		script = buildings/civilian/clone_vats_and_evochambers
		CAN_BUILD = yes
		TIER = @DELTA_TIER
		EXPONENT = @DELTA_EXPONENT
		UPGRADES_INTO = building_acot_ae_clone_vats
		ALLOW = "has_enigmatic_capital = yes"
		PREREQUISITE = tech_acot_dm_clone_vats
		PLANET_MODIFIER = "
			sr_dark_matter = @vats_cost
			acot_sr_dark_energy = @vats_cost
			"
		PLANET_UPKEEP = "
			sr_dark_matter = @vats_upkeep
			acot_sr_dark_energy = @vats_upkeep
			"
		AI_FACTORS = "
			modifier = {
				factor = 0
				OR = {
					has_building = building_acot_dm_clone_vats
					has_building = building_acot_ae_clone_vats
				}
			}
			"
	}
}
building_acot_dm_hive_evochamber = {
	base_cap_amount = 1
	inline_script = {
		script = buildings/civilian/clone_vats_and_evochambers
		CAN_BUILD = yes
		TIER = @DELTA_TIER
		EXPONENT = @DELTA_EXPONENT
		UPGRADES_INTO = building_acot_ae_hive_evochamber
		ALLOW = "has_enigmatic_capital = yes"
		PREREQUISITE = tech_acot_dm_hive_evochamber
		PLANET_MODIFIER = "
			sr_dark_matter = @vats_cost
			acot_sr_dark_energy = @vats_cost
			"
		PLANET_UPKEEP = "
			sr_dark_matter = @vats_upkeep
			acot_sr_dark_energy = @vats_upkeep
			"
		AI_FACTORS = "
			modifier = {
				factor = 0
				OR = {
					has_building = building_acot_dm_hive_evochamber
					has_building = building_acot_ae_hive_evochamber
				}
			}
			"
	}
}

#####################
# Military
#####################
building_acot_dm_stronghold = {
	inline_script = {
		script = buildings/military/stronghold
		TIER = @DELTA_TIER
		PREREQUISITE = tech_acot_dm_stronghold
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		UPGRADES_INTO = building_acot_ae_stronghold
		JOB = aot_dm_soldier
		AI_FACTORS = "
			modifier = {
				weight = 100000
				num_pops >= 4000
				NOR = {
					OR = {
						num_buildings = {
							type = building_acot_dm_stronghold
							value <= 1
						}
						num_buildings = {
							type = building_acot_ae_stronghold
							value <= 1
						}
					}
				}
				planet_owner = {
					has_monthly_income = {
						resource = sr_dark_matter
						value <= 3
					}
				}
			}
			"
	}
	custom_tooltip = building_acot_dm_stronghold_tooltip
	resources = {
		category = planet_buildings
		cost = {
			alloys = 400
			sr_dark_matter = 250
			acot_sr_dark_energy = 125
		}
		upkeep = {
			trigger = {
				planet_owner = {
					NOT = {
						has_technology = tech_acot_fractured_autoharvesting
					}
				}
			}
			sr_dark_matter = 2
			acot_sr_dark_energy = 2
		}
	}
}
building_giga_fortress_dm = {
	inline_script = {
		script = buildings/military/giga_fortress
		TIER = @DELTA_TIER
		PREREQUISITE = tech_giga_fortress_dm
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		UPGRADES_INTO = building_acot_giga_fortress
		JOBS_REGULAR = "
			job_aot_dm_giga_fortress_operator_add = 100
			"
		JOBS_HIVE = "
			job_aot_dm_giga_fortress_operator_drone_add = 100
			"
		JOBS_MACHINE = "
			job_aot_dm_giga_fortress_operator_drone_add = 100
			"
		JOBS_FE = "
			job_acot_giga_fortress_operator_ancient_add = 200
			"
		COST = "
			minerals = 20000
			influence = 100
			sr_dark_matter = 300
			acot_sr_dark_energy = 300
			"
		UPKEEP = "
			energy = 5
			volatile_motes = 1
			exotic_gases = 1
			rare_crystals = 1
			sr_dark_matter = 1
			acot_sr_dark_energy = 1
			"
		PRODUCES = "
			unity = 25
			food = 25
			"
		AI_FACTORS = "
			modifier = {
				factor = 0
				planet_owner = {
					has_monthly_income = {
						resource = sr_dark_matter
						value <= 3
					}
				}
			}
			"
	}
	planet_modifier = {
		planet_amenities_add = 5        # Mod Pack; reduced from 10
		planet_housing_add = 5        # Mod Pack; reduced from 10
		planet_stability_add = 5        # Mod Pack; reduced from 25
	}
	army_modifier = {
		army_defense_morale_mult = 0.25
		army_defense_health_mult = 0.25
		army_defense_damage_mult = 0.5
	}
}
building_acot_dm_psg = {
	planet_limit = 1
	inline_script = {
		script = buildings/military/planetary_shield_generator
		TIER = @DELTA_TIER
		PREREQUISITE = tech_acot_ae_psg
		UPGRADES_INTO = building_acot_ae_psg
		ALLOW = "
			has_enigmatic_capital = yes
			NOT = {
				has_building = building_planetary_shield_generator
			}
			acot_has_shield_building = no
			if = {
				limit = { exists = orbital_defence }
				orbital_defence = {
					exists = starbase
					starbase = {
						NOR = {
							has_starbase_building = ring_orbital_shield_generator
							is_starbase_building_building = ring_orbital_shield_generator
						}
					}
				}
			}
			"
		CAN_BUILD = yes
		REDUCTION_FACTOR = -0.7
		AI_FACTORS = "
			modifier = {
				factor = 0
				planet_owner = {
					has_monthly_income = {
						resource = acot_sr_dark_energy
						value <= 3
					}
				}
			}
			"
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = 150
			acot_sr_dark_energy = 50
		}
		upkeep = {
			trigger = {
				planet_owner = {
					NOT = {
						has_technology = tech_acot_fractured_autoharvesting
					}
				}
			}
			acot_sr_dark_energy = 1
		}
	}
}

#####################
# Misc
#####################
building_dm_commercial_megaplex = {
	inline_script = {
		script = buildings/civilian/commercial_megaplex
		TIER = @DELTA_TIER
		EXPONENT = @ALPHA_EXPONENT
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		PREREQUISITE = tech_dm_commercial_megaplex
		UPGRADES_INTO = building_ae_commercial_megaplex
		JOB = dm_clerk
		COST = "
			minerals = 500
			sr_dark_matter = 200
			"
		UPKEEP = "
			energy = 10
			sr_dark_matter = 2
			"
		AI_FACTORS = "
			modifier = {
				weight = 1
				planet_owner = {
					resource_income_compare = {
						resource = sr_dark_matter
						value >= 3
					}
					resource_income_compare = {
						resource = energy
						value >= 15
					}
				}
			}
			modifier = {
				factor = 10
				exists = planet_owner
				planet_owner = {
					is_megacorp = yes
				}
			}
			"
	}
}
building_dm_bureaucratic = {
	inline_script = {
		script = buildings/civilian/bureaucratic
		TIER = @DELTA_TIER
		EXPONENT = @ALPHA_EXPONENT
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		PREREQUISITE = tech_dm_bureau
		UPGRADES_INTO = building_ae_bureaucratic
		JOB = dm_bureaucrat
		COST = "
			minerals = 500
			sr_dark_matter = 200
			"
		UPKEEP = "
			energy = 10
			sr_dark_matter = 2
			"
		AI_FACTORS = "
			modifier = {
				factor = 0
				buildings_has_crystals = no
			}
			modifier = {
				factor = 2
				planet_owner = {
					empire_sprawl_over_cap > 0
				}
			}
			modifier = {
				factor = 2
				planet_owner = {
					empire_sprawl_over_cap > 10
				}
			}
			modifier = {
				factor = 2
				planet_owner = {
					empire_sprawl_over_cap > 20
				}
			}
			modifier = {
				factor = 2
				planet_owner = {
					empire_sprawl_over_cap > 40
				}
			}
			modifier = {
				factor = 2
				planet_owner = {
					has_valid_civic = civic_byzantine_bureaucracy
				}
			}
			"
	}
}
building_dm_embassy = {
	base_cap_amount = 1
	inline_script = {
		script = buildings/civilian/embassy
		TIER = @DELTA_TIER
		ALLOW = "has_enigmatic_capital = yes"
		CAN_BUILD = yes
		PREREQUISITE = tech_dm_embassy
		UPGRADES_INTO = building_ae_embassy
		COST = "
			influence = 50
			energy = 400
			minerals = 750
			sr_dark_matter = 200
			"
		UPKEEP = "
			energy = 15
			sr_dark_matter = 3
			"
		AI_FACTORS = "
			modifier = {
				factor = 0
				buildings_has_crystals = no
			}
			modifier = {
				factor = 5
				exists = planet_owner
				planet_owner = {
					is_galactic_community_member = yes
				}
			}
			modifier = {
				factor = 5
				exists = planet_owner
				planet_owner = {
					has_federation = yes
				}
			}
			modifier = {
				factor = 3
				exists = planet_owner
				planet_owner = {
					is_part_of_galactic_council = yes
				}
			}
			"
	}
}

###############################################################
# Research Building
###############################################################
building_acot_dm_enigmatic_lab = {
	inline_script = {
		script = buildings/civilian/enigmatic_lab
		TIER = @DELTA_TIER
		EXPONENT = @ALPHA_EXPONENT
		PREREQUISITE = tech_acot_dm_enigmatic_lab
		UPGRADES_INTO = building_acot_ae_enigmatic_lab
		ALLOW = "has_enigmatic_capital = yes"
		JOB = acot_researcher
		JOB_HIVE = acot_researcher_drone
		CAN_BUILD = yes
		COST = "
			minerals = 500
			sr_dark_matter = 50
			acot_sr_dark_energy = 50
			"
		AI_FACTORS = "
			modifier = {
				factor = 5000000
				num_buildings = {
					type = building_acot_dm_enigmatic_lab
					value <= 1
				}
			}
			modifier = {
				factor = 0
				OR = {
					num_buildings = {
						type = building_acot_dm_enigmatic_lab
						value >= 3
					}
					num_buildings = {
						type = building_acot_dm_enigmatic_lab
						value >= 3
					}
				}
			}
			modifier = {
				factor = 0
				planet_owner = {
					has_monthly_income = {
						resource = sr_dark_matter
						value <= 3
					}
				}
			}
			modifier = {
				factor = 0
				planet_owner = {
					has_monthly_income = {
						resource = energy
						value <= 10
					}
				}
			}
			modifier = {
				factor = 0
				planet_owner = {
					has_monthly_income = {
						resource = consumer_goods
						value <= 10
					}
				}
			}
			"
	}
}
building_delta_nexus = {
	inline_script = {
		script = buildings/production/power_conduit
		TIER = @DELTA_TIER
		EXPONENT = @DELTA_EXPONENT
		ALLOW = "
			has_enigmatic_capital = yes
			NOR = {
				has_building = building_acot_stellarite_nexus
				has_building = building_phanon_stellarite_nexus
				has_building = building_alpha_nexus
				has_building = building_delta_nexus
			}
			"
		CAN_BUILD = yes
		PREREQUISITE = tech_delta_nexus
		UPGRADES_INTO = building_alpha_nexus
		STORAGE_INCREASE = "
			country_resource_max_sr_dark_matter_add = @max_conduit_storage
			country_resource_max_acot_sr_dark_energy_add = @max_conduit_storage
			"
		PLANET_MODIFIER = "
			planet_jobs_sr_dark_matter_produces_mult = @planet_mult
			planet_jobs_acot_sr_dark_energy_produces_mult = @planet_mult
			"
		AI_FACTORS = "
			modifier = {
				factor = 0
				planet_owner = {
					merg_is_awakened_fe = yes
				}
			}
			modifier = {
				factor = 10000
				planet_owner = {
					has_monthly_income = {
						resource = sr_dark_matter
						value <= 1
					}
				}
			}
			modifier = {
				factor = 10000
				planet_owner = {
					has_monthly_income = {
						resource = acot_sr_dark_energy
						value <= 1
					}
				}
			}
			"
	}
	resources = {
		category = planet_buildings
		cost = {
			minerals = 2000
			acot_sr_dark_energy = 1500
			sr_dark_matter = 1500
		}
		upkeep = {
			trigger = {
				planet_owner = {
					is_ai = no
				}
			}
			sr_dark_matter = 400
			acot_sr_dark_energy = 400
			energy = 500
		}
	}
}
